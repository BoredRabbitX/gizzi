<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gruppo Gizzi - Cilento Food Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1b4332; /* Verde foresta cilentano */
            --accent: #b08d57;  /* Oro brunito/terra */
            --light: #fdfaf5;   /* Crema pergamena */
            --text: #2d2d2d;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light);
            color: var(--text);
            margin: 0;
            line-height: 1.6;
        }

        /* Navigazione e Lingue */
        .top-bar {
            background: var(--primary);
            color: white;
            padding: 10px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lang-switcher button {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            margin-left: 5px;
            border-radius: 4px;
        }

        .lang-switcher button.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        header {
            background: white;
            padding: 40px 5%;
            text-align: center;
            border-bottom: 4px solid var(--accent);
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: var(--primary);
            margin: 0;
            letter-spacing: 1px;
        }

        .sub-logo {
            font-style: italic;
            color: var(--accent);
            font-size: 1.1rem;
        }

        /* Vetrina */
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }

        .product-card {
            background: white;
            border-radius: 2px; /* Look pi√π editoriale, meno "giocattolo" */
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: 0.3s;
            position: relative;
        }

        .product-card:hover { transform: translateY(-10px); }

        .product-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .card-content { padding: 25px; }

        .category-tag {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
            font-weight: 600;
        }

        h3 { font-family: 'Playfair Display', serif; margin: 10px 0; font-size: 1.4rem; }

        .price { font-size: 1.3rem; font-weight: 600; color: var(--primary); }

        .btn-add {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }

        .btn-add:hover { background: var(--accent); }

        /* Recensioni Merchant */
        .merchant-reply {
            margin-top: 15px;
            font-size: 0.85rem;
            background: #f9f9f9;
            padding: 10px;
            border-left: 2px solid var(--primary);
        }

        /* Floating Cart */
        #cart-trigger {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 99;
        }

        .cart-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--accent);
            border-radius: 50%;
            padding: 5px 8px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

<div class="top-bar">
    <div>Cilento, Italy | Gruppo Gizzi</div>
    <div class="lang-switcher">
        <button onclick="setLang('it')" id="btn-it" class="active">IT</button>
        <button onclick="setLang('en')" id="btn-en">EN</button>
        <button onclick="setLang('de')" id="btn-de">DE</button>
    </div>
</div>

<header>
    <div class="logo-text">GRUPPO GIZZI</div>
    <div class="sub-logo" id="header-sub">Eccellenze Agricole dal Cuore del Cilento</div>
</header>

<div class="container">
    <div id="shop" class="grid">
        </div>
</div>

<div id="cart-trigger" onclick="checkout()">
    üõí <span class="cart-badge" id="count">0</span>
</div>

<script>
    const CONFIG = {
        catalogo: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0aLcG9mPmNexSlEt-5MaNlpIPUF7LPvdlsJwDhoa_1PZfsvFbw9eQu4uBpsrqwTng9TrkqvxcoQRm/pub?gid=118341302&single=true&output=csv",
        recensioni: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0aLcG9mPmNexSlEt-5MaNlpIPUF7LPvdlsJwDhoa_1PZfsvFbw9eQu4uBpsrqwTng9TrkqvxcoQRm/pub?gid=534419137&single=true&output=csv",
        waNumber: "393330000000"
    };

    let currentLang = 'it';
    let database = [];
    let feedback = [];
    let cart = [];

    const i18n = {
        it: { sub: "Eccellenze Agricole dal Cuore del Cilento", add: "Aggiungi al Carrello", order: "Ciao Gruppo Gizzi, vorrei ordinare:" },
        en: { sub: "Premium Agricultural Goods from the Heart of Cilento", add: "Add to Cart", order: "Hello Gruppo Gizzi, I'd like to order:" },
        de: { sub: "Premium Agrarprodukte aus dem Herzen des Cilento", add: "In den Warenkorb", order: "Hallo Gruppo Gizzi, ich m√∂chte bestellen:" }
    };

    async function init() {
        const [resP, resR] = await Promise.all([fetch(CONFIG.catalogo), fetch(CONFIG.recensioni)]);
        database = parseCSV(await resP.text());
        feedback = parseCSV(await resR.text());
        render();
    }

    function parseCSV(text) {
        const rows = text.split('\n');
        const headers = rows[0].includes('\t') ? rows[0].split('\t') : rows[0].split(',');
        return rows.slice(1).map(row => {
            const cols = row.includes('\t') ? row.split('\t') : row.split(',');
            let data = {};
            headers.forEach((h, i) => data[h.trim()] = cols[i]?.trim());
            return data;
        });
    }

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-switcher button').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + lang).classList.add('active');
        document.getElementById('header-sub').innerText = i18n[lang].sub;
        render();
    }

    function render() {
        const container = document.getElementById('shop');
        container.innerHTML = database.map(p => {
            // Logica per nomi multilingua (se aggiungerai le colonne Nome_EN etc)
            const nome = p[`Nome_${currentLang.toUpperCase()}`] || p.Nome;
            const desc = p[`Descrizione_${currentLang.toUpperCase()}`] || p.Descrizione;
            const recs = feedback.filter(f => f.ID_Prodotto === p.ID);

            return `
                <div class="product-card">
                    <img src="${p.Immagine}" alt="${nome}">
                    <div class="card-content">
                        <span class="category-tag">${p.Categoria}</span>
                        <h3>${nome}</h3>
                        <p style="font-size: 0.9rem; color: #666;">${desc}</p>
                        <div class="price">‚Ç¨ ${p.Prezzo} <small>/ ${p.Unit√†}</small></div>
                        <button class="btn-add" onclick="addToCart('${p.ID}')">${i18n[currentLang].add}</button>
                        
                        ${recs.map(r => `
                            <div class="merchant-reply">
                                <strong>${r.Cliente}:</strong> ‚≠ê ${r.Voto}<br>
                                "${r.Commento}"
                                ${r.Risposta_Gizi ? `<br><small><strong>Gruppo Gizzi:</strong> ${r.Risposta_Gizi}</small>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }

    function addToCart(id) {
        const p = database.find(x => x.ID === id);
        cart.push(p);
        document.getElementById('count').innerText = cart.length;
    }

    function checkout() {
        if(cart.length === 0) return;
        let msg = i18n[currentLang].order + "\n";
        cart.forEach(i => msg += `- ${i.Nome} (‚Ç¨${i.Prezzo})\n`);
        window.open(`https://wa.me/${CONFIG.waNumber}?text=${encodeURIComponent(msg)}`);
    }

    init();
</script>
</body>
</html>
